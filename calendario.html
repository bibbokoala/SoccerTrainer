<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <link href="css/bootstrap.min.css" rel="stylesheet">
   <!-- CSS FOR TOGGLE LEFT MENU -->
     <link href='http://fonts.googleapis.com/css?family=Exo+2:400,600,300,900' rel='stylesheet' type='text/css'>
     <link href="css/navbar-static-top.css" rel="stylesheet">
     <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
     <link href="css/bootstrap-datepicker3.css" rel="stylesheet">
   <!-- END CSS FOR TOGGLE LEFT MENU -->
   <link href="css/custom.css" rel="stylesheet">
   <script src="phonegap.js"></script>
   <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
   <script src="js/jquery.min.js"></script>
   <!-- DOCUMENTAZIONE DATEPICKER: https://bootstrap-datepicker.readthedocs.io/en/stable/index.html -->
   <script src="js/bootstrap-datepicker.min.js"></script>
   <script src="js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/0.9.0rc1/jspdf.min.js"></script>

<script type="text/javascript" charset="utf-8">
    // Call onDeviceReady when Cordova is loaded.
    // At this point, the document has loaded but cordova-1.8.1.js has not.
    // When Cordova is loaded and talking with the native device,
    // it will call the event `deviceready`.
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
        //alert("onload");

        $('#event_details').on('hidden.bs.modal', function () {
          //$("#tabella_dettagli").show();
          //document.getElementById('tabella_dettagli').style.display = 'block';
          //document.getElementById('div_qrcode').style.display = 'none';
          console.log("#event_details on hidden.bs.modal");
          //DEBUG window.alert('CLOSE MODAL - tabella_dettagli: ' + document.getElementById('tabella_dettagli').style.display);
        });

    }
    // Cordova is loaded and it is now safe to make calls Cordova methods
    function onDeviceReady() {
        document.addEventListener("offline", onOffline, false);
        document.addEventListener("online", onOnline, false);
        if (device.model!=null)
        {
          localStorage.setItem("duuid", device.uuid);
          localStorage.setItem("dmodel", device.model);
          localStorage.setItem("dplatform", device.platform);
          localStorage.setItem("dversion", device.version);
        }
        //alert("onDeviceReady");
    }
    // Handle the back browser button
    document.addEventListener("backbutton", onBackKeyDown, false);
    function onBackKeyDown() {
      if (confirm("Chiudere l'applicazione?")) {
        navigator.app.exitApp();
      }
    }
    /* NON SO SE PUO' SERVIRE
    localStorage.removeItem('inizio');
    localStorage.removeItem('fine');
    */
</script>
    <link href="fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css"/>
    <style>
      .badge{margin-bottom:2px;width:180px;}
      /* Background colors */
      .bg-red,
      .bg-green,
      .bg-navy,
      .bg-red {background-color: #f56954 !important;}
      .bg-green {background-color: #00a65a !important;}
      .bg-navy {background-color: #001f3f !important;}
      .bg-white {color: #222222 !important;background-color: #f9f9f9 !important;}
       h2 {font-size: 20px;} /* serve per rendere piu piccolo il titolo del full calendar */
    </style>

    <script src="fullcalendar/lib/jquery.min.js" type="text/javascript"></script>
    <!-- NON SO A COSA SERVE <script src="fullcalendar/lib/jquery-ui.custom.min.js" type="text/javascript"></script>-->
    <script src="fullcalendar/lib/moment.min.js" type="text/javascript"></script>
    <script src="fullcalendar/fullcalendar.js" type="text/javascript"></script>
    <!-- <script src="fullcalendar/locale-all.js" type="text/javascript"></script> -->
    <script src="fullcalendar/locale/it.js" type="text/javascript"></script>

<link href="css/jquery.datetimepicker.css" rel="stylesheet" type="text/css"/>
  <script src="js/bootstrap.min.js"></script>  
  <!-- <script src="js/jquery-ui.js"></script> -->
  <script src="js/jquery.datetimepicker.full.min.js" type="text/javascript"></script>
<!-- DOCUMENTATIONS AND EXAMPLES: http://xdsoft.net/jqplugins/datetimepicker/ -->
  <script src="js/moment_with_locales.js"></script>
  <script>
  console.log("ELEMENTI DI NAVIGAZIONE:");
  console.log("matricola: "+localStorage.getItem("matricola"));
  console.log("password: "+localStorage.getItem("password"));
  console.log("auth: "+localStorage.getItem("auth"));
  console.log("token: "+localStorage.getItem("token"));
  console.log("login: "+localStorage.getItem("login"));
  console.log("link: "+localStorage.getItem("link"));

    function checkImage (src, good, bad) {
      var img = new Image();
      img.onload = good; 
      img.onerror = bad;
      img. src = src;
    }

    function openExternal(url){
      var ref = cordova.InAppBrowser.open(url, '_system', 'location=yes');
    }

  $( function() {

    $('#start_date').datetimepicker({
       format:'Y-m-d H:i',
       minDate: 0,
       minTime: 0,
       step: 15,
       minTime:'00:01',
       maxTime:'23:59',
       onChangeDateTime:function(dp,$input){
          console.log("start_date onchange value: " + $input.val());
          $('#start_date').val($input.val());
       }
    });
    $('#end_date').datetimepicker({
       format:'Y-m-d H:i',
       minDate: 0,
       minTime: 0,
       step: 15,
       minTime:'00:01',
       maxTime:'23:59',
       onChangeDateTime:function(dp,$input){
          console.log("end_date onchange value: " + $input.val());
          $('#end_date').val($input.val());
       }
    });

    $('#upd_start_date').datetimepicker({
       format:'Y-m-d H:i',
       minDate: 0,
       minTime: 0,
       step: 15,
       minTime:'00:01',
       maxTime:'23:59',
       onChangeDateTime:function(dp,$input){
          console.log("upd_start_date onchange value: " + $input.val());
          $('#upd_start_date').val($input.val());
       }
    });
    $('#upd_end_date').datetimepicker({
       format:'Y-m-d H:i',
       minDate: 0,
       minTime: 0,
       step: 15,
       minTime:'00:01',
       maxTime:'23:59',
       onChangeDateTime:function(dp,$input){
          console.log("upd_end_date onchange value: " + $input.val());
          $('#upd_end_date').val($input.val());
       }
    });

  });
  </script>
<script>
  //VARIABILI GLOBALI:
  var obj_events  = [];
  var obj_details = [];

  $(document).ready(function() {

    $("#logo_big").click(function(){
      window.location = "home.html";
    });
    var matricola = localStorage.getItem("matricola");
    $("#matricola").val(matricola);

    function call(){
      var inizio = localStorage.getItem("inizio");
      var fine = localStorage.getItem("fine");
      console.log("removeEvents");
      $('#calendar').fullCalendar('removeEvents');
      //RECUPERO TUTTI GLI EVENTI X CREATORE:
      var remote_url = "http://linkin.it/Projects/SoccerTrainer/STGetEvents.php";
      $.ajax({
        url: remote_url,
            type: 'POST', // Send post data
          data : { matricola: matricola , inizio: inizio , fine: fine },
            async: false,
            success: function(s){
              obj_events = s;
              console.log(JSON.stringify(obj_events));
              renderEvents();
            }
      });
    }
    call();

    //RECUPERO LE SQUADRE X CREATORE:
    var remote_url = "http://linkin.it/Projects/SoccerTrainer/STGetSquads.php";
    $.ajax({
      url: remote_url,
          type: 'POST', // Send post data
          data: 'matricola=' + matricola,
          async: false,
          success: function(s){
            obj_squads = s;
            console.log(JSON.stringify(obj_squads));
            var squadre = "";
            for(var o=0; o<obj_squads.length;o++){
              var valore = obj_squads[o].id_squadra;
              var descrizione = obj_squads[o].squadra;
              squadre += "<option value='"+valore+"'>"+descrizione+"</option>";
            }
            $('#upd_id_squadra').html(squadre);
            $('#id_squadra').html(squadre);
          }
    });
    
  
    $('#btn_exit').click(function() {
      if (confirm("Chiudere l'applicazione?")) {
        navigator.app.exitApp();
      }
    });

    $("#btn_del_event").click(function(){
      console.log("btn_del_event");
      var booking_id = $("#booking_id").val();
      //alert("booking_id: " + booking_id);
      if ( (booking_id==null)||
           (booking_id.localeCompare("")==0) )
      {
        return false;
      }
      var formData = $("#form_upd_event").serialize();
      console.log(formData);
      var url = "http://linkin.it/Projects/SoccerTrainer/STDelEvent.php";
      $.ajax({
        url: url,
            type: 'POST', // Send post data
            data: formData,
            async: false,
            success: function(s){
              var result_del = s;
              console.log(JSON.stringify(result_del));
              setTimeout(function(){ window.location = "calendario.html"; }, 1500);
            }
      });

    });

    $("#btn_upd_event").click(function(){
      console.log("btn_upd_event");
      var booking_id = $("#upd_id_evento").val();
      // alert("booking_id: " + booking_id);
      if ( (booking_id==null)||
           (booking_id.localeCompare("")==0) )
      {
        return false;
      }      
      var a = moment($("#upd_start_date").val(),'YYYY-MM-DD hh:mm');
      var b = moment($("#upd_end_date").val(),'YYYY-MM-DD hh:mm');
      var diffHours = b.diff(a, 'hours');
      //alert(diffHours);
      if(diffHours<0){
        $("#upd_start_date").css('background-color', 'red');
        $("#upd_end_date").css('background-color', 'red');
        return false;
      }
      var formData = $("#form_upd_event").serialize();
      var url = "http://linkin.it/Projects/SoccerTrainer/STUpdEvent.php";
      $.ajax({
        url: url,
        type: 'POST', // Send post data
        data: formData,
        async: false,
        success: function(s){
          var result_upd = s;
          console.log(JSON.stringify(result_upd));
          //DEBUG alert(JSON.stringify(result_upd));
          setTimeout(function(){ window.location = "calendario.html"; }, 1500);
        }
      });

    });

    $("#btn_save_new_event").click(function(){
      console.log("btn_save_new_event");
      var a = moment($("#start_date").val(),'YYYY-MM-DD hh:mm');
      var b = moment($("#end_date").val(),'YYYY-MM-DD hh:mm');
      var diffHours = b.diff(a, 'hours');
      //alert(diffHours);
      if(diffHours<=0){
        $("#start_date").css('background-color', 'red');
        $("#end_date").css('background-color', 'red');
        return false;
      }
      var formData = $("#form_new_event").serialize();
      console.log(formData);
      var url = "http://linkin.it/Projects/SoccerTrainer/STInsEvent.php";
      //DEBUG alert(url + " " + formData);
      $.ajax({
        url: url,
            type: 'POST', // Send post data
            data: formData,
            async: false,
            success: function(s){
              var result_insert = s;
              console.log(JSON.stringify(result_insert));
              //$('#new_event').modal('hide');
              setTimeout(function(){ window.location = "calendario.html"; }, 1500);
            }
      });
      $('.fc-bg table tr').eq(1).css('clientHeight', '44px');
      $('.ui-widget-content').height( 30 ).css({      cursor: "auto"    });
    });

    function getPrenDetails(prenID){
      for(i = 0; i < obj_events.length; i++) {
        //console.log("prenID: " + prenID + " - obj_events[i].id: " + obj_events[i].id);
        if (prenID === obj_events[i].id){
          //console.log("TROVATO!");
          obj_details.push( obj_events[i] );
          //console.log(JSON.stringify(obj_details));
        }
      }
    }

/*
DOCUMENTAZIONE: https://fullcalendar.io/docs
You can dynamically set a calendar’s height after initialization:
$('#calendar').fullCalendar('option', 'height', 700);
*/
    $('#calendar').fullCalendar({
      themeSystem: 'bootstrap4',
        height: 450,
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay,listMonth'
      },
      weekNumbers: false,
      eventLimit: true, // allow "more" link when too many events
        //defaultDate: '2015-01-20',
        selectable: true,
        //selectHelper: true,
        selectOverlap: function (event) {
            return event.rendering != 'background';
        },
      //events: obj_events,
      eventAfterAllRender: function(date, jsEvent, view) {
          var view = $('#calendar').fullCalendar('getView');
          if (view.name=='month') {
          console.log("The view's name is " + view.name);
          console.log("The view's title is " + view.title);
          console.log("The view's start is " + view.start);
          console.log("The view's end is " + view.end);
          console.log("The view's intervalStart is " + view.intervalStart);
          console.log("The view's intervalEnd is " + view.intervalEnd);
          var mesi = ["01","02","03","04","05","06","07","08","09","10","11","12","01"];
          var date = new Date(view.start);
          var month = date.getMonth();
          var year = date.getFullYear();
          var inizio = year+'-'+mesi[month]+'-31';
          var date = new Date(view.end);
          var month = date.getMonth();
          var year = date.getFullYear();
          var fine = year+'-'+mesi[month]+'-01';
          console.log("mese between "+inizio + " and " + fine);
          var matricola = localStorage.getItem('matricola');
          $("#download").attr("href", "http://linkin.it/Projects/SoccerTrainer/PDF_Calendario.php?matricola="+matricola+"&inizio="+inizio+"&fine="+fine);
          $("#download").show();
          if(localStorage.getItem('inizio')!=inizio){
            localStorage.setItem('inizio',inizio);
            localStorage.setItem('fine',fine);
            call();
          }
        }
      },
      dayClick: function(date, jsEvent, view) {
            //date contiene il giorno cliccato sul calendario nel formato: Wed Nov 30 2016 00:00:00 GMT+0000
            /* Rimosso x SoccerTrainer
            var Time_ClickNuovoPNR;
            Time_ClickNuovoPNR = moment();
            var currentdate = new Date();
            var currentHours = currentdate.getHours();
            currentHours = ("0" + currentHours).slice(-2);
            //aggiungo due minuti alla data inizio prenotazione
            currentdate.setMinutes(currentdate.getMinutes() + 2)
            var currentMin = currentdate.getMinutes();
            currentMin = ("0" + currentMin).slice(-2);
            var enddate = new Date ( currentdate );
            //aggiungo due ore alla data fine prenotazione
            enddate.setHours ( currentdate.getHours() + 2 );
            var endHours = enddate.getHours();
            endHours = ("0" + endHours).slice(-2);
            var endMin = enddate.getMinutes();
            endMin = ("0" + endMin).slice(-2);
            if ((Time_ClickNuovoPNR.startOf('day').diff(date.startOf('day'),'minutes')) <= 0)
            {         
               //$(this).css('background-color', 'orange');
               $('#start_date').val(date.format('YYYY-MM-DD HH:mm:ss'));
               $('#end_date').val(date.format('YYYY-MM-DD HH:mm:ss'));
               $('#utilizzatore').val(localStorage.getItem("matricola"));
               $('#start_date').val(date.format("YYYY-MM-DD " + currentHours + ":" + currentMin ) );
               $('#end_date').val(date.format("YYYY-MM-DD " + endHours + ":" + endMin ) );
               if (date>currentdate){           
                 //$(this).css('background-color', 'green');
                 $('#start_date').val(date.format("YYYY-MM-DD 08:00") );
                 $('#end_date').val(date.format("YYYY-MM-DD 10:00") );
               }
               $('#new_event').modal();
            }
            */
            //Modifica x SoccerTrainer
            $('#start_date').val(date.format("YYYY-MM-DD 08:00") );
            $('#end_date').val(date.format("YYYY-MM-DD 10:00") );
            $('#new_event').modal();

        }, //FINE dayClick
      eventClick: function(calEvent, jsEvent, view) {
        getPrenDetails(calEvent.id);
        $('#booking_id').val(calEvent.id);
        console.log(JSON.stringify(obj_details));
        var i;
        for(i = 0; i < obj_details.length; i++) {
          var upd_matricola = obj_details[i].creatore;
          var upd_id_evento = obj_details[i].id;
          var upd_nome_evento = obj_details[i].title;
          var upd_start_date = obj_details[i].start;
          var upd_end_date = obj_details[i].end;
          var upd_tipo_evento = obj_details[i].status;
          var upd_desc_evento = obj_details[i].desc_evento;
          var upd_id_squadra = obj_details[i].id_squadra;
          $('#upd_matricola').val(upd_matricola);
          $('#upd_id_evento').val(upd_id_evento);
          $('#upd_nome_evento').val(upd_nome_evento);
          $('#upd_start_date').val(upd_start_date);
          $('#upd_end_date').val(upd_end_date);
          $('#upd_tipo_evento').val(upd_tipo_evento);
          $('#upd_desc_evento').val(upd_desc_evento);
          $('#upd_id_squadra').val(upd_id_squadra);
        }
        $('#event_details').modal();
      }  //FINE eventClick
      ,dateFormat: 'YYYY-MM-DD'
      ,timeFormat: 'H:mm'
    });  /* close fullCalendar */

//RENDERIZZO GLI EVENTI SUL CALENDARIO:
    function renderEvents(){
      //console.log(JSON.stringify(obj_events));
      for(i = 0; i < obj_events.length; i++) {
        /*DEBUG element
        console.log("id: " + obj_events[i].id);
        console.log("title: " + obj_events[i].title);
        console.log("start: " + obj_events[i].start);
        console.log("end: " + obj_events[i].end);
        console.log("status: " + status);
        */
        var status = obj_events[i].status;
        var backgroundColor = "#CCCCCC";
        var textColor = "#000";
        if ( (status.localeCompare("PARTITA")==0) )
        {
            backgroundColor = "#f56954";
            textColor = "#FFF";
        }
        if ( (status.localeCompare("ALLENAMENTO")==0) )
        {
            backgroundColor = "#00a65a";
            textColor = "#FFF";
        }
        if ( (status.localeCompare("RIUNIONE")==0) )
        {
            backgroundColor = "#001f3f";
            textColor = "#FFF";
        }

        $('#calendar').fullCalendar('renderEvent', {
            "id": obj_events[i].id, 
            "title": obj_events[i].title,
            "start": obj_events[i].start,
            "end": obj_events[i].end ,
            "allDay": false,
            "backgroundColor": backgroundColor,
            "textColor": textColor,
            "borderColor": "#333" 
          },true);
      }
    }
    //renderEvents();

  }); /* close document ready */


</script>

<style>
  body {
    margin: 40px 10px;
    padding: 0;
    font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
  }
  #calendar {
    max-width: 900px;
    margin: 0 auto;
    font-size: 14px;
  }
</style>
</head>
<body onload="onLoad()">
    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-fixed-top gradienti">
      <div class="container">
        <div class="navbar-header">
          <!-- BUTTON FOR TOGGLE LEFT MENU -->
            <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
             <span class="icon-bar" style="background-color: #FFF;"></span>
             <span class="icon-bar" style="background-color: #FFF;"></span>
             <span class="icon-bar" style="background-color: #FFF;"></span>
            </button>
          <!-- solo per la pagina index.html NON ESISTE IL MENU ed il logo ha un margine di 40 pixel -->
          <div class="navbar-header" style="line-height: 56px;" id="testata" >
            <b id='logo_big' >Soccer Trainer</b>
            <a id="btn_exit" type="button" class='.navbar-toggle pull-right' style="color: #FFF;" >
               <span class="glyphicon glyphicon-remove" aria-hidden="true" style="color: #FFF;" ></span>&nbsp;&nbsp;&nbsp;
            </a>
            <a id="btn_logout" type="button" class='.navbar-toggle pull-right' style="color: #FFF;" >
               <span class="  glyphicon glyphicon-log-out" aria-hidden="true" style="color: #FFF;" ></span>&nbsp;&nbsp;&nbsp;
            </a>
          </div>
        </div>
      </div>
    </nav>
    <!-- <div class="container-fluid" style="max-width: 540px;" id="fluido" > -->
    <div class="container-fluid" id="fluido" >
      <div class="row">


      <!-- sidebar LEFT MENU -->      <!-- sidebar -->
      <div class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas" >
        <div id="prova" style="width:100%;" data-toggle="offcanvas" data-target=".sidebar-nav">
          <ul data-spy="affix" data-offset-top="120" id="affix" class="nav nav-stacked" >
            <li><p><B>FUNZIONALITA'</B></p></li>
            <li><a href="squadre.html"> <span class="glyphicon glyphicon-transfer" aria-hidden="true" ></span>&nbsp;&nbsp;SQUADRE</a></li>
            <li><a href="calciatori.html"> <span class="glyphicon glyphicon-user" aria-hidden="true" ></span>&nbsp;&nbsp;CALCIATORI</a></li>
            <li><a href="calendario.html"> <span class="glyphicon glyphicon-calendar" aria-hidden="true" ></span>&nbsp;&nbsp;CALENDARIO
              <div style="padding-left:26px;">
                <label>Legenda:</label><br>
                <small class="badge bg-green"><font color="white">ALLENAMENTO</font></small><br>
                <small class="badge bg-red"><font color="white">PARTITA</font></small><br>
                <small class="badge bg-navy"><font color="white">RIUNIONE</font></small><br>
              </div>
              </a>
            </li>
            <li><a href="allenamenti.html"> <span class="glyphicon glyphicon-bullhorn" aria-hidden="true" ></span>&nbsp;&nbsp;ALLENAMENTI</a></li>
            <li><a href="partite.html"> <span class="glyphicon glyphicon-play-circle" aria-hidden="true" ></span>&nbsp;&nbsp;PARTITE</a></li>
            <li><a href="riunioni.html"> <span class="glyphicon glyphicon-briefcase" aria-hidden="true" ></span>&nbsp;&nbsp;RIUNIONI</a></li>
          </ul>
          <ul id="footer_menu" data-spy="affix" data-offset-top="120" id="affix" class="nav nav-stacked" >
            <li><p><B>EXTRA</B></p></li>
            <li><a href="impostazioni.html"> <span class="glyphicon glyphicon-info-sign" aria-hidden="true" ></span>&nbsp;&nbsp;INFORMAZIONI</a></li>
            <li><a id="btn_logout"> <span class="glyphicon glyphicon-log-out" aria-hidden="true" ></span>&nbsp;&nbsp;LOGOUT</a></li>
          </ul>
        </div> <!-- chiude prova -->  
      </div>


      <!-- content -->
      <div class="col-xs-12  col-sm-8 col-md-9 content">
        <div class="col-lg-12" id="contenuto" >
          <div id='calendar' style="margin-top: 20px;margin-right: -30px;margin-left: -30px;"></div>
        </div>
      </div>
      <br>&nbsp;<br>
      <a id='download' class='btn btn-warning' href='' >
        <span class="glyphicon glyphicon-download" aria-hidden="true" ></span>&nbsp;&nbsp;DOWNLOAD PDF
      </a>

    </div>
  </div>
</body>
</html>

<style>
.table_pren td{
  padding:5px;
}
label{
  font-size: 12px;
}
</style>

  <!-- Modal -->
  <div class="modal fade" id="new_event" role="dialog" style="color:#000000;" >
    <div class="modal-dialog">
      <form class="form" id="form_new_event" name="form_new_event" >  
      <input type="hidden" name='matricola' id='matricola' />
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"><span class="glyphicon glyphicon-calendar"></span> Nuovo Evento</h4>
        </div>
        <div class="modal-body">
        <table class='table_pren' width="100%" style="color:#000000;" >
          <tr>
            <td colspan='2'>
              <label for='nome_evento' >Nome Evento <font color=red>*</font> </label>
              <input type="text" required id="nome_evento" name="nome_evento" class="form-control" />
            </td>
          </tr>
          <tr>
            <td colspan='2'>
              <label for='tipo_evento' >Tipo Evento <font color=red>*</font> </label>
              <select required id="tipo_evento" name="tipo_evento" class="form-control" >
                <option value="ALLENAMENTO">ALLENAMENTO</option>
                <option value="PARTITA">PARTITA</option>
                <option value="RIUNIONE">RIUNIONE</option>
              </select>
            </td>
          </tr>
          <tr>
            <td colspan='2'>
              <label for='id_squadra' >Squadra </label>
              <select id="id_squadra" name="id_squadra" class="form-control"></select>
            </td>
          </tr>
          <tr>
            <td>
              <label for='date_start' >Data Inizio <font color=red>*</font> </label>
                <input type="text" class="form-control pull-right" id="start_date" name="start_date"/>
            </td>
            <td>
              <label for='date_end' >Data Fine <font color=red>*</font> </label>
                <input type="text" class="form-control pull-right" id="end_date" name="end_date"/>
            </td>
          </tr>
            <td colspan='2'>
              <label for='desc_evento' >Descrizione Evento </label>
              <textarea type="text" rows="4" id="desc_evento" name="desc_evento" class="form-control" ></textarea>
            </td>
          </tr>
          <tr>
        </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">
            <span class="glyphicon glyphicon-remove"></span> Annulla
          </button>
          <button type="button" class="btn btn-primary" id="btn_save_new_event" data-dismiss="modal">
            <span class="glyphicon glyphicon-ok"></span> Inserisci
          </button>
        </div>
      </div>
      </form>
    </div>
  </div>


  <!-- Modal -->
  <div class="modal fade" id="event_details" role="dialog" style="color:#000000;" >
    <div class="modal-dialog">
      <form class="form" id="form_upd_event" name="form_upd_event" >  
      <input type="hidden" name='upd_matricola' id='upd_matricola' />
      <input type="hidden" name='upd_id_evento' id='upd_id_evento' />
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"><span class="glyphicon glyphicon-calendar"></span> Modifica Evento</h4>
        </div>
        <div class="modal-body">
        <table class='tabella_dettagli' width="100%" style="color:#000000;" >
          <tr>
            <td colspan='2'>
              <label for='upd_nome_evento' >Nome Evento <font color=red>*</font> </label>
              <input type="text" id="upd_nome_evento" name="upd_nome_evento" class="form-control" />
            </td>
          </tr>
          <tr>
            <td colspan='2'>
              <label for='upd_tipo_evento' >Tipo Evento <font color=red>*</font> </label>
              <select required id="upd_tipo_evento" name="upd_tipo_evento" class="form-control" >
                <option value="ALLENAMENTO">ALLENAMENTO</option>
                <option value="PARTITA">PARTITA</option>
                <option value="RIUNIONE">RIUNIONE</option>
              </select>
            </td>
          </tr>
          <tr>
            <td colspan='2'>
              <label for='upd_id_squadra' >Squadra </label>
              <select id="upd_id_squadra" name="upd_id_squadra" class="form-control"></select>
            </td>
          </tr>
          <tr>
            <td>
              <label for='upd_date_start' >Data Inizio <font color=red>*</font> </label>
                <input type="text" class="form-control pull-right" id="upd_start_date" name="upd_start_date"/>
            </td>
            <td>
              <label for='upd_date_end' >Data Fine <font color=red>*</font> </label>
                <input type="text" class="form-control pull-right" id="upd_end_date" name="upd_end_date"/>
            </td>
          </tr>
            <td colspan='2'>
              <label for='upd_desc_evento' >Descrizione Evento </label>
              <textarea type="text" rows="4" id="upd_desc_evento" name="upd_desc_evento" class="form-control" ></textarea>
            </td>
          </tr>
          <tr>
        </table>
        <div id='presenze' style='display: none;' ></div>
        </div>
        <div class="modal-footer">
          <input type="hidden" id="booking_id" name="booking_id" value="" />
          <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">
            <span class="glyphicon glyphicon-remove"></span> Chiudi
          </button>
          <button type="button" class="btn btn-danger" id="btn_del_event" data-dismiss="modal">
            <span class="glyphicon glyphicon-minus"></span> Rimuovi
          </button>
          <button type="button" class="btn btn-primary" id="btn_upd_event" data-dismiss="modal">
            <span class="glyphicon glyphicon-ok"></span> Modifica
          </button>
        </div>
      </div>
      </form>
    </div>
  </div>

    <!-- TOGGLE MENU -->
    <script>

      function getPresenze(){
        var evento_id  = $("#booking_id").val();
        var id_squadra = $("#upd_id_squadra").val();
        var squadra    = $("#upd_id_squadra").text();
        if (id_squadra!=null){
          var matricola = localStorage.getItem("matricola");
          if (matricola==null)
              matricola="simone";
          var id_profilo = localStorage.getItem("id_profilo");
          if (id_profilo==null)
              id_profilo="1";
          var random = Math.random();
          //LISTA CALCIATORI ASSOCIATI ALLA SQUADRA
          var url = "http://linkin.it/Projects/SoccerTrainer/STGetSquadPlayers.php";
          $.ajax({
            url: url,
                type: 'POST', // Send post data
                data: {id_squadra: id_squadra, matricola: matricola, id_profilo: id_profilo, random: random},
                async: false,
                success: function(s){
                  html = "<h4>PRESENZE "+squadra+"</h4>";
                  obj_players_squad = s;
                  console.log(JSON.stringify(obj_players_squad));
                  var squadre = "";
                  for(var o=0; o<obj_players_squad.length;o++){
                    var valore = obj_players_squad[o].id_calciatore;
                    var descrizione = obj_players_squad[o].nome + " "  +obj_players_squad[o].cognome;
                    html += "<input type='checkbox' id='"+valore+"' name='"+valore+"' value='"+valore+"'> "+descrizione+" <br>";
                    console.log("<input type='checkbox' id='"+valore+"' name='"+valore+"' value='"+valore+"'> "+descrizione+" <br>");
                    console.log(html);
                    $( "#presenze" ).html(html);
                    $( "#presenze" ).show();
                  }
                }
          });
        }
      }

      $(document).ready(function() {

      $( "#upd_tipo_evento" ).change(function() {
        var tipo_value = $( "#upd_tipo_evento" ).val();
        //DEBUG alert( "Handler for .change() upd_tipo_evento value: " + tipo_value );
        if (tipo_value==="ALLENAMENTO"){
          getPresenze();
        }
        else{
          $( "#presenze" ).hide();
          $( "#presenze" ).html("");
        }
      });

      $('[data-toggle=offcanvas]').click(function() {
        $('.sidebar-offcanvas').toggleClass('active', 1000);
      });
    });
    </script>