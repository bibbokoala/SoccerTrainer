<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <link href="css/bootstrap.min.css" rel="stylesheet">
   <!-- CSS FOR TOGGLE LEFT MENU -->
     <link href='http://fonts.googleapis.com/css?family=Exo+2:400,600,300,900' rel='stylesheet' type='text/css'>
     <link href="css/navbar-static-top.css" rel="stylesheet">
     <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
   <!-- END CSS FOR TOGGLE LEFT MENU -->
   <link href="css/custom.css" rel="stylesheet">
<script src="phonegap.js"></script>
   <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> -->
   <script src="js/jquery.min.js"></script>
   <script src="js/menu.js"></script>
 <script type="text/javascript" charset="utf-8">
    // Call onDeviceReady when Cordova is loaded.
    // At this point, the document has loaded but cordova-1.8.1.js has not.
    // When Cordova is loaded and talking with the native device,
    // it will call the event `deviceready`.
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
        //alert("onload");
    }
    // Cordova is loaded and it is now safe to make calls Cordova methods
    function onDeviceReady() {
        document.addEventListener("offline", onOffline, false);
        document.addEventListener("online", onOnline, false);
        if (device.model!=null)
        {
          localStorage.setItem("duuid", device.uuid);
          localStorage.setItem("dmodel", device.model);
          localStorage.setItem("dplatform", device.platform);
          localStorage.setItem("dversion", device.version);
        }
        //alert("onDeviceReady");
    }
    // Handle the offline event
    function onOffline() {
      $("#offline-alert").alert();
      $("#offline-alert").fadeTo(2000, 500).slideUp(500, function(){
        $("#offline-alert").alert('close');
      });   
      //alert("Il dispositivo e' OffLine\nQuesta App richiede una connessione internet!");
      //btn_login disabled
      $('#btn_login').addClass( "disabled" );
    }
    // Handle the online event
    function onOnline() {
      $("#online-alert").alert();
      $("#online-alert").fadeTo(2000, 500).slideUp(500, function(){
        $("#online-alert").alert('close');
      });   
      //alert("Il dispositivo e' OnLine!");
      //btn_login enabled!
      $('#btn_login').removeClass( "disabled" );
    }
    // Handle the back browser button
    document.addEventListener("backbutton", onBackKeyDown, false);
    function onBackKeyDown() {
      if (confirm("Chiudere l'applicazione?")) {
        navigator.app.exitApp();
      }
    }

  function debugLocalStorage(){
    console.log("***** START debugLocalStorage *****");
    for (var i = 0; i < localStorage.length; i++){
      console.log(i + ") [localStorage] chiave: " + localStorage.key(i) + " - valore: " + localStorage.getItem(localStorage.key(i)));
    }
    console.log("*****  END debugLocalStorage  *****");
  }

  $.fn.serializeObject = function()
  {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
          if (o[this.name] !== undefined) {
              if (!o[this.name].push) {
                  o[this.name] = [o[this.name]];
              }
              o[this.name].push(this.value || '"');
          } else {
              o[this.name] = this.value || '"';
          }
      });
      return o;
  };

  function delPlayer(id_player){
    if (confirm("Vuoi veramente eliminare il calciatore?")) {
      var url = "http://linkin.it/Projects/SoccerTrainer/STDelPlayer.php";
      console.log("url: " + url + "- id_player: " + id_player );
      $.ajax({
        url: url,
        cache : false,
        dataType : "json",
        data : { id_calciatore: id_player },
        success: function(s){
          var result_insert = s;
          console.log(JSON.stringify(result_insert));
          window.location = "calciatori.html";
        } 
      });
    }
  }

  $(document).ready(function() {

    $("#logo_big").click(function(){
      window.location = "home.html";
    });

    $('#btn_exit').click(function() {
      if (confirm("Chiudere l'applicazione?")) {
        navigator.app.exitApp();
      }
    });


    $("#btn_nuova_scheda").click(function(){
      window.location = "nuova_scheda.html?id=" + $("#indice_calciatore").val();
    });

    $("#btn_storico_schede").click(function(){
      window.location = "storico_schede.html?id=" + $("#indice_calciatore").val();
    });

    $("#btn_backward").click(function(){
      window.location = "calciatori.html";
    });

    $("#btn_cancella_calciatore").click(function(){
      delPlayer($("#indice_calciatore").val());
    });


    $( "#matricola" ).keydown(function( event ) {
      if ( event.which == 13 ) {
        event.preventDefault();
        $( "#password" ).focus();
      }
      console.log("Handler for .keydown() called ");
      console.log("event: "+event.which);
    });

    $( "#matricola" ).change(function(){
        this.value = this.value.toLowerCase();
        //DEBUG alert(this.value);
    });


    $( "#password" ).keydown(function( event ) {
      if ( event.which == 13 ) {
        event.preventDefault();
        $("#btn_login").click();
      }
    });

    $("#btn_logout").click(function(){
      if (confirm("Effettuare il Log-out?")) {
        localStorage.clear();
        console.log("btn_logout: "+localStorage.getItem("login"));
        window.location.href = 'index.html';
      }
    });

    $('#btn_indietro').click(function() {
      window.location.href = 'calciatori.html';
    });

    function infoPlayer(){
      var last_params = window.location.search.substr(1);
      var pos = last_params.indexOf("&");
      if (pos>0)
        var res = last_params.substring(0, pos);
      else
        var res = last_params;
      var items = res.split("=");
      var i = items[1];
      console.log("parametro - id=[" + i + "]");
      var lista_calciatori = JSON.parse( localStorage.getItem("lista_calciatori") );
      var html = "<div class='alert alert-calciatore' role='alert'>" + 
                 "<font size='6'><B>" + lista_calciatori[i].nome + " " + lista_calciatori[i].cognome + "</B></font><br>" + 
                 //"[id: " + lista_calciatori[i].id_calciatore + "]<br>" + 
                 "nato il <b>" + lista_calciatori[i].data_nascita + "</b> a <b>" + lista_calciatori[i].luogo_nascita + "</b> " + 
                 "nazionalit&agrave;: <b>" + lista_calciatori[i].nazionalita + "</b> " + 
                 "altezza <b>" + lista_calciatori[i].altezza_cm + "</b> cm " + 
                 "peso <b>" + lista_calciatori[i].peso_kg + "</b> kg " + 
                 "</div>";
      $("#dati_calciatore").html(html);
      //SERVONO PER VALORIZZARE I CAMPI DEL MODALE changePlayer
      $("#player_change").val(lista_calciatori[i].id_calciatore);
      $("#nome").val(lista_calciatori[i].nome);
      $("#cognome").val(lista_calciatori[i].cognome);
      $("#data_nascita").val(lista_calciatori[i].data_nascita);
      $("#luogo_nascita").val(lista_calciatori[i].luogo_nascita);
      $("#nazionalita").val(lista_calciatori[i].nazionalita);
      $("#altezza_cm").val(lista_calciatori[i].altezza_cm);
      $("#peso_kg").val(lista_calciatori[i].peso_kg);
      //SERVE per conoscere l'indice corrispondente al calciatore nella lista calciatori
      $("#indice_calciatore").val(i);
      //SERVE per conoscere l'id sul database corrispondente al calciatore
      $("#id_calciatore").val(lista_calciatori[i].id_calciatore);
      $("#matricola").val(localStorage.getItem("matricola"));
      if (lista_calciatori[i].num_calc>0){
        $('#btn_cancella_calciatore').prop("disabled", true);
      }
      else{
        $('#btn_cancella_calciatore').prop("disabled", false);
      }
      $("#creatore").html("<br><i>creatore: " + lista_calciatori[i].creatore + "</i>");
    }
    infoPlayer();

    $("#btn_change_player").click(function(){
      if (confirm("Vuoi modificare il calciatore?")) {
        var formData = $("#form_change_player").serialize();
        console.log(formData);
        var url = "http://linkin.it/Projects/SoccerTrainer/STUpdPlayer.php";
        $.ajax({
          url: url,
          type: 'POST', // Send post data
          data: formData,
          async: false,
          success: function(s){
            var result_insert = s;
            console.log(JSON.stringify(result_insert));
            $('#changePlayer').modal('hide');
            window.location = "calciatori.html";
          } 
        });
      }
      else{
        //se non si vuole salvare chiudo il modale!
        $('#changePlayer').modal('hide');
      }
    });

  });  
</script>

</head>
<body onload="onLoad()">
    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-fixed-top gradienti">
      <div class="container">
        <div class="navbar-header">
          <!-- BUTTON FOR TOGGLE LEFT MENU -->
            <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
             <span class="icon-bar" style="background-color: #FFF;"></span>
             <span class="icon-bar" style="background-color: #FFF;"></span>
             <span class="icon-bar" style="background-color: #FFF;"></span>
            </button>
          <!-- solo per la pagina index.html NON ESISTE IL MENU ed il logo ha un margine di 40 pixel -->
          <div class="navbar-header" style="line-height: 56px;" id="testata" >
            <a id="btn_backward" type="button" class='.navbar-toggle pull-left' style="color: #FFF;" >
               &nbsp;&nbsp;&nbsp;<span class="  glyphicon glyphicon-step-backward" aria-hidden="true" style="color: #FFF;" ></span>
            </a>
            <b id='logo_big' >Soccer Trainer</b>
            <a id="btn_exit" type="button" class='.navbar-toggle pull-right' style="color: #FFF;" >
               <span class="glyphicon glyphicon-remove" aria-hidden="true" style="color: #FFF;" ></span>&nbsp;&nbsp;&nbsp;
            </a>
            <a id="btn_logout" type="button" class='.navbar-toggle pull-right' style="color: #FFF;" >
               <span class="  glyphicon glyphicon-log-out" aria-hidden="true" style="color: #FFF;" ></span>&nbsp;&nbsp;&nbsp;
            </a>
          </div>
        </div>
      </div>
    </nav>
    <!-- <div class="container-fluid" style="max-width: 540px;" id="fluido" > -->
    <div class="container-fluid" id="fluido" >
      <div class="row">


      <!-- sidebar LEFT MENU -->      <!-- sidebar -->
      <div class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas" >
        <div id="prova" style="width:100%;" data-toggle="offcanvas" data-target=".sidebar-nav">
          <ul data-spy="affix" data-offset-top="120" id="affix" class="nav nav-stacked" >
            <li><p><B>FUNZIONALITA'</B></p></li>
            <li><a href="squadre.html"> <span class="glyphicon glyphicon-transfer" aria-hidden="true" ></span>&nbsp;&nbsp;SQUADRE</a></li>
            <li><a href="calciatori.html"> <span class="glyphicon glyphicon-user" aria-hidden="true" ></span>&nbsp;&nbsp;CALCIATORI</a></li>
            <li><a href="calendario.html"> <span class="glyphicon glyphicon-calendar" aria-hidden="true" ></span>&nbsp;&nbsp;CALENDARIO</a></li>
            <li><a href="allenamenti.html"> <span class="glyphicon glyphicon-bullhorn" aria-hidden="true" ></span>&nbsp;&nbsp;ALLENAMENTI</a></li>
            <li><a href="partite.html"> <span class="glyphicon glyphicon-play-circle" aria-hidden="true" ></span>&nbsp;&nbsp;PARTITE</a></li>
            <li><a href="riunioni.html"> <span class="glyphicon glyphicon-briefcase" aria-hidden="true" ></span>&nbsp;&nbsp;RIUNIONI</a></li>
          </ul>
          <ul id="footer_menu" data-spy="affix" data-offset-top="120" id="affix" class="nav nav-stacked" >
            <li><p><B>EXTRA</B></p></li>
            <li><a href="impostazioni.html"> <span class="glyphicon glyphicon-info-sign" aria-hidden="true" ></span>&nbsp;&nbsp;INFORMAZIONI</a></li>
            <li><a id="btn_logout"> <span class="glyphicon glyphicon-log-out" aria-hidden="true" ></span>&nbsp;&nbsp;LOGOUT</a></li>
          </ul>
        </div> <!-- chiude prova -->  
      </div>



        <div class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 main" id="contenuto" >
          <div id='dati_calciatore' ></div>
          <div class='alert alert-identificativi' role='alert'>
            <input type='hidden' name='id_calciatore' id='id_calciatore' >
            <input type='hidden' name='indice_calciatore' id='indice_calciatore' >
            <button id='btn_nuova_scheda' class='btn  btn-success' >
              <span class='glyphicon glyphicon-plus' aria-hidden='true' ></span> 
            </button>
            <button id='btn_storico_schede' class='btn  btn-info' >
              <span class='glyphicon glyphicon-list' aria-hidden='true' ></span> 
            </button>
            <button class='btn  btn-warning'  data-toggle='modal' data-target='#changePlayer' >
              <span class='glyphicon glyphicon-pencil' aria-hidden='true' ></span> 
            </button>
            <button id='btn_cancella_calciatore' class='btn  btn-danger' >
              <span class='glyphicon glyphicon-remove' aria-hidden='true' ></span> 
            </button>
          </div>
          <button id='btn_indietro' class='btn  btn-warning' >INDIETRO</button> 
          <br><span id='creatore' style='font-size:12px;'></span>
        </div> <!-- close <div class="col-sm-12 col-sm-offset-0 col-md-12 col-md-offset-0 main"> -->
      </div> <!-- close div row --> 
    </div> <!-- close div container-fluid -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script>    

    $(document).ready(function() {
      
      $('[data-toggle=offcanvas]').click(function() {
        if ($( ".sidebar-offcanvas-right" ).hasClass( "active" )){
          $('.sidebar-offcanvas-right').toggleClass('active', 1000);
        }
        $('.sidebar-offcanvas').toggleClass('active', 1000);
      });

      $('[data-toggle=offcanvas-right]').click(function() {
        if ($( ".sidebar-offcanvas" ).hasClass( "active" )){
          $('.sidebar-offcanvas').toggleClass('active', 1000);
        }
        $('.sidebar-offcanvas-right').toggleClass('active', 1000);
      });

    });
    debugLocalStorage();
    </script>
    </body>



<!-- Modal changePlayer -->
  <div class="modal fade" id="changePlayer" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content" style="font-size:75%;line-height:12px;">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modifica Calciatore</h4>
        </div>
        <div class="modal-body">
          <form id='form_change_player'>
            <input type='hidden' id='player_change' name='player_change' />
            <div class="form-group">
              <label for="nome">Nome:</label>
              <input class='form-control' type='text' id='nome' name='nome' value='' autofocus onchange="javascript:{this.value = this.value.toUpperCase(); }" /> 
            </div>
            <div class="form-group">
              <label for="cognome">Cognome:</label>
              <input class='form-control' type='text' id='cognome' name='cognome' value='' onchange="javascript:{this.value = this.value.toUpperCase(); }" />  
            </div>
            <div class="form-group">
              <label for="luogo_nascita">Luogo Nascita:</label>
              <input class='form-control' type='text' id='luogo_nascita' name='luogo_nascita' value='ROMA' onchange="javascript:{this.value = this.value.toUpperCase(); }" />  
            </div>
            <div class="form-group"> <!-- Date input -->
              <label class="control-label" for="data_nascita">Data di Nascita</label>
              <input class="form-control" id="data_nascita" name="data_nascita" placeholder="gg/mm/aaaa" type="text"/>
            </div>
            <div class="form-group">
              <label for="nazionalita">Nazionalita:</label>
              <input class='form-control' type='text' id='nazionalita' name='nazionalita' value='ITALIANA' onchange="javascript:{this.value = this.value.toUpperCase(); }" /> 
            </div>
            <div class="form-group">
              <label for="altezza_cm">Altezza in cm:</label>
              <input class='form-control' type='number' id='altezza_cm' name='altezza_cm' value='' /> 
            </div>
            <div class="form-group">
              <label for="peso_kg">Peso in kg:</label>
              <input class='form-control' type='number' id='peso_kg' name='peso_kg' value='' /> 
            </div>
            <input type='hidden' id='matricola' name='matricola' value='' />
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-success" id='btn_change_player' >Salva</button>
        </div>
      </div>
    </div>
  </div>
<!-- END Modal -->

</html>